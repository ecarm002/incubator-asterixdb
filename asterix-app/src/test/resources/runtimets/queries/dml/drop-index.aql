/*
 * Description     : Drop secondary index.
 * Expected Result : Success
 * Date            : 12th July 2012
 *
 */

drop dataverse test if exists;
create dataverse test;
use dataverse test;

create type Schema as closed {
unique1:  int64,
unique2:  int64,
two:  int64,
four:  int64,
ten:  int64,
twenty:  int64,
onePercent: int64,
tenPercent:  int64,
twentyPercent:  int64,
fiftyPercent:  int64,
unique3:  int64,
evenOnePercent: int64,
oddOnePercent:  int64,
stringu1:  string,
stringu2:  string,
string4:  string
}

create dataset t1(Schema) partitioned by key unique2;

// Load data
load dataset t1
using "edu.uci.ics.asterix.external.dataset.adapter.NCFileSystemAdapter"
(("path"="nc1://data/wisc/onektup.adm"),("format"="delimited-text"),("delimiter"="|")) pre-sorted;

// create secondary indexes
create index idx_t1_str1 on t1(stringu1);
create index idx_t1_unique1 on t1(unique1);

// drop secondary indexes
drop index t1.idx_t1_str1;
drop index t1.idx_t1_unique1;

write output to nc1:"rttest/dml_drop-index.adm";

for $a in dataset('t1')
where $a.unique1 > 10 and $a.stringu1="DGAAAAXXXXXXXXXXXXXXXXXXX"
return $a
